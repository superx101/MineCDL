# MCDL

## 介绍

MCDL 与项目本身 MineCDL 不同，MCDL全称为MineCraft Command Definition Language（我的世界命令定义语言）。
而MineCDL除了包含MCDL外，还有《我的世界》命令解析器和目标代码生成器。

## 结构

### 注释

与python注释一样，MCDL中使用 `#` 表示一个单行注释，使用 `"""` `"""` 表示一个多行注释，注释中的内容将不会被解析。

> 例
> 
> \# 这是一个单行注释
>
> """
> 
> 这是一个多行注释
>
> 这是第二行
>
> """

### 缩进

与python缩进类似，MCDL使用 `TAB` 或 `4个空格` 表示缩进

::: warning
缩进一定是 `TAB` 或 `4个空格`。如果使用 1-3个空格，将会被解析器认为没有缩进，导致代码解析与预期结果不符。
:::

### 树和分支

一个mcdl可以包含很多棵指令树，指令树间相互独立不会影响（因此你可以定义两个完全相同的指令树）。

每个指令树由一个根结点和多个分支构成，每个分支由多个子分支构成，并且分支末尾必须有一个函数，用于匹配到分支后执行相应的程序

所以树结构如下：

```
指令1根结点
    分支1（由多个定义结点构成）
        分支1处理函数
    分支2
        子分支1
            子分支1处理函数
        子分支2
            子分支2处理函数
    ...
    分支n
        分支n处理函数

指令2根结点
    ...
    （同指令1）

...
```

### 结点

分支则由多个结点构成，每个结点对应指令中的一个参数

从类型上看，结点分为3种类型

- 枚举型
- 变量型
- 函数型

## 类型

### 枚举型结点

#### 定义

枚举由英文或数字构成，用于匹配某个固定的值。
> 例如指令：`scoreboard objectives` 和 `scoreboard players`

如果不想输入太长的字符，可以给枚举取一个别名，多个名称间用 "`|`" 隔开。
比如指令 `teleport` 别名 `tp` 和 `t` 在MCDL中表示为：
```text
teleport | tp | t

或

teleport|tp|t
```

#### 必要性

以指令 `fill <from: x y z> <to: x y z> <block> [destroy|hollow|keep|outline|replace]` 为例，最后一个参数常常可以省略。MCDL将这种可以省略的参数称为可选参数，而可选的枚举型结点又称为可选枚举。

用 `()` 来表示一个可选枚举，上述的fill指令可以表述为

```
fill
    <from>: xyz << 3
        <to>: xyz << 3
            <block>: Block
                (destroy|hollow|keep|outline) # 可选枚举
                    f1()
                replace # 必要枚举
                    <block>: Block
                        f2()
```

### 变量型结点

#### 变量名必要性

与枚举不同，变量需要明确的写出必要性。用 `<>` 表示一个强制性变量，`[]` 表示一个可选变量。括号内部则表示变量名。

> 例如 \<mandatory\> \[optional\]

#### 类型声明

一个变量必须有类型声明，类型声明定义了一个变量的类型和接收参数的个数。在变量名后加上 `: 类型名称 << 参数个数` 的方式定义一个类型。

> 比如MC中常见的坐标类型，我们在MCDL中定义为一个变量名是pos，变量类型为IntPos，变量参数为3的结点
> ```
> tp
>     <pos>: IntPos << 3
>         f1()
> ```

请注意，如果参数个数为1，可以省略参数个数的定义，直接写类型名称

> 例
> ```
> tp
>     <player>: Player
>         f1()
> ```

#### 隐式变量与类型推断

::: warning
此方法仅适用于相同变量名和类型的变量，且类型推断仅在同一棵树内有效。
:::

如果你有多个相同类型的变量，则可以只写 `必要性` 和 `参数名` 来定义一个变量，程序分析时会根据已有类型定义的变量来推断这个变量的类型。MCDL将这种写法称作隐式的变量定义。

> 例
> ```
> tp
>     <pos>: IntPos << 3
>         <pos>
>             f1()
> ```

### 函数型结点

函数型结点用 `名称()` 来定义，用于定义一个处理函数。当函数所在的分支被匹配时，执行这个函数。

::: warning
每个分支的处理不同，因此MCDL要求同一棵树内不得有相同名称的函数，且一个分支有且仅有一个函数。

如果你的定义不合法，解析器将会报错。
::: 

> 例
> ```
> cmd1 | c1
>     f1()
> 
> cmd2
>     branch1 | b1
>         f1()
>     branch2
>         f2()
> ```

## 尾声

至此，你已经学会了MCDL所有语法，可以开始使用MCDL了。

但是，如果你想定义一个复杂指令，可能会遇到一些二义性问题，关于这些问题将会在[二义性问题](./command_parser.md#二义性问题)给出解释。